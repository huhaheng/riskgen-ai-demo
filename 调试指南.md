# 🔧 调试指南 - Knowledge Base 数据不显示

> 如果 Knowledge Base 页面没有显示数据，按照这个指南排查

---

## 第一步：打开浏览器控制台

1. 在浏览器中打开页面：`http://localhost:8000`
2. **按 F12** 打开开发者工具（或右键 → 检查）
3. 点击 **"Console"** 标签

## 第二步：检查数据是否加载

在控制台中输入以下命令（复制粘贴后按回车）：

### 检查 1：Knowledge Base 数据
```javascript
window.KNOWLEDGE_CASES
```

**正常结果**：应该显示一个包含 4 个对象的数组
```javascript
(4) [{…}, {…}, {…}, {…}]
```

**如果显示 `undefined`**：说明数据文件没有加载 ❌

### 检查 2：数据数量
```javascript
window.KNOWLEDGE_CASES ? window.KNOWLEDGE_CASES.length : 'Not loaded'
```

**正常结果**：应该显示 `4`

### 检查 3：查看第一个案例
```javascript
window.KNOWLEDGE_CASES[0]
```

**正常结果**：应该显示案例的详细信息

---

## 第三步：根据结果采取行动

### 情况 A：显示 `undefined` 或 `Not loaded`

**原因**：`js/knowledge_data.js` 文件没有加载

**解决方案**：

#### 方案 1：检查文件路径
1. 确认文件存在：
   ```
   项目文件夹/js/knowledge_data.js
   ```

2. 检查 index.html 中的引用：
   ```html
   <script src="js/knowledge_data.js"></script>
   ```

#### 方案 2：检查服务器
- 确保使用本地服务器运行（`http://localhost:8000`）
- 不要直接双击 index.html 文件

#### 方案 3：检查浏览器缓存
- 按 **Ctrl+Shift+R**（或 Cmd+Shift+R）**强制刷新**
- 这会清除缓存重新加载所有文件

### 情况 B：显示了数据，但页面还是空白

**原因**：初始化时机或 DOM 元素问题

**解决方案**：

#### 手动触发渲染
在控制台输入：
```javascript
window.initKnowledgeBaseNow()
```

这会强制重新渲染 Knowledge Base。

**如果显示数据了** ✅：说明是初始化时机问题，刷新页面应该就好了

**如果还是空白** ❌：继续下一步

### 情况 C：检查 DOM 元素

在控制台输入：
```javascript
document.getElementById('kb-documents-grid')
```

**正常结果**：应该显示一个 `<div>` 元素

**如果显示 `null`** ❌：说明 HTML 结构有问题

---

## 第四步：强制刷新页面

如果上面都检查过了，试试这个：

1. **清除缓存强制刷新**
   - Windows: **Ctrl + Shift + R**
   - Mac: **Cmd + Shift + R**

2. **重启服务器**
   - 在终端按 **Ctrl+C** 停止服务器
   - 重新运行：`python3 -m http.server 8000`
   - 刷新浏览器

3. **换个浏览器试试**
   - 如果用的 Chrome，试试 Edge 或 Firefox

---

## 第五步：查看错误信息

在控制台的 **Console** 标签中：

### 寻找红色错误信息

常见错误：
- `Failed to load resource: js/knowledge_data.js` → 文件路径错误
- `KNOWLEDGE_CASES is not defined` → 数据未加载
- `Cannot read property of undefined` → 数据格式问题

**截图或复制错误信息**，然后可以针对性解决。

---

## 🔍 完整诊断命令

把这些命令全部复制到控制台，一次性检查：

```javascript
console.log('=== 诊断开始 ===');
console.log('1. Knowledge Cases:', window.KNOWLEDGE_CASES ? '✅ Loaded (' + window.KNOWLEDGE_CASES.length + ')' : '❌ Not loaded');
console.log('2. Demo Data:', window.BACKEND_DATA_JSON ? '✅ Loaded (' + window.BACKEND_DATA_JSON.length + ')' : '❌ Not loaded');
console.log('3. KB Grid Element:', document.getElementById('kb-documents-grid') ? '✅ Found' : '❌ Not found');
console.log('4. Router:', window.appRouter ? '✅ Initialized' : '❌ Not initialized');
console.log('=== 诊断结束 ===');
```

**把输出结果告诉我**，我可以帮你进一步分析。

---

## 🆘 快速修复

如果检查下来是数据加载问题，最简单的方法：

### 在控制台直接加载数据

```javascript
// 手动定义 Knowledge Cases（临时测试用）
window.KNOWLEDGE_CASES = [
    {
        id: 'case_001',
        documentName: 'Test Case',
        status: 'active',
        projectInfo: { industry: 'Insurance', projectType: 'AI/ML', region: 'HK' },
        tags: ['test'],
        retrievalSummary: 'Test summary',
        assessmentStats: { totalRisksIdentified: 10, criticalRisks: 1, highRisks: 2 },
        keyRisks: []
    }
];

// 然后刷新 Knowledge Base
window.initKnowledgeBaseNow();
```

**如果这样能显示** ✅：说明代码逻辑没问题，是文件加载的问题

---

## 💡 最可能的原因

根据经验，最常见的原因是：

1. **浏览器缓存** (80%) → 强制刷新（Ctrl+Shift+R）
2. **文件路径错误** (15%) → 检查 js/knowledge_data.js 是否存在
3. **初始化时机** (5%) → 在控制台手动调用 `window.initKnowledgeBaseNow()`

---

**📝 把控制台的输出结果告诉我，我可以帮你精准定位问题！**


