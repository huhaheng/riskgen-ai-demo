<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RiskGen AI - Operational Risk Assessment</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Merriweather:wght@300;400;700&display=swap"
        rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="theme-light">

    <div id="app">

        <!-- === VIEW: DASHBOARD === -->
        <div id="view-dashboard" class="main-view active">
            <header class="dashboard-header">
                <div class="brand">
                    <div class="logo-icon"><i class="fa-solid fa-shield-cat"></i></div>
                    <h1>RiskGen <span class="badge-beta">AI Beta</span></h1>
                </div>
                <nav class="header-nav">
                    <button class="nav-tab active" id="nav-projects" onclick="showDashboardTab('projects')">
                        <i class="fa-solid fa-folder-open"></i> Projects
                    </button>
                    <button class="nav-tab" id="nav-knowledge" onclick="showDashboardTab('knowledge')">
                        <i class="fa-solid fa-book"></i> Knowledge Base
                    </button>
                    <button class="nav-tab" id="nav-settings" onclick="showDashboardTab('settings')">
                        <i class="fa-solid fa-gear"></i> Settings
                    </button>
                </nav>
                <div class="user-controls">
                    <button class="icon-btn theme-toggle"><i class="fa-regular fa-moon"></i></button>
                    <div class="avatar">AU</div>
                </div>
            </header>

            <div class="dashboard-content">
                <!-- Projects Tab Content -->
                <div id="tab-projects" class="dashboard-tab active">
                    <div class="hero-section">
                        <h2>Welcome to AI-Powered Risk Management</h2>
                        <p>Create detailed operational risk assessments in minutes with customized LLM prompts.</p>
                    </div>

                    <div class="projects-grid-header">
                        <h3>My Projects</h3>
                        <button class="btn primary-btn" id="btn-create-project">
                            <i class="fa-solid fa-plus"></i> New Project
                        </button>
                    </div>

                    <div id="project-list" class="projects-grid">
                        <!-- Project Cards Injected Here -->
                    </div>
                </div>

                <!-- Knowledge Base Tab Content -->
                <div id="tab-knowledge" class="dashboard-tab hidden">
                    <!-- View Switcher -->
                    <div class="kb-view-switcher">
                        <button class="kb-view-btn active" data-view="cases" id="kb-view-cases">
                            <i class="fa-solid fa-list"></i> By Case
                        </button>
                        <button class="kb-view-btn" data-view="taxonomy" id="kb-view-taxonomy">
                            <i class="fa-solid fa-diagram-project"></i> By Risk Taxonomy
                        </button>
                    </div>
                    
                    <!-- Case View (Default) -->
                    <div class="kb-view-content active" id="kb-view-content-cases">
                        <!-- Master-Detail Layout -->
                        <div class="kb-master-detail">
                            <!-- Left: Case List Panel -->
                            <div class="kb-list-panel">
                                <div class="kb-list-header">
                                    <div class="kb-title-row">
                                        <h2><i class="fa-solid fa-book-open"></i> Knowledge Base</h2>
                                        <button class="btn primary-btn btn-sm" id="btn-upload-case">
                                            <i class="fa-solid fa-plus"></i> Upload
                                        </button>
                                    </div>
                                    <p class="kb-subtitle">Historical operational risk assessment papers for AI context</p>
                                </div>
                            
                            <!-- Search -->
                            <div class="kb-search-box">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                <input type="text" id="kb-search" placeholder="Search cases...">
                            </div>
                            
                            <!-- Filters -->
                            <div class="kb-filters">
                                <select id="filter-business-unit">
                                    <option value="">All Business Units</option>
                                </select>
                                <select id="filter-case-type">
                                    <option value="">All Case Types</option>
                                </select>
                                <select id="filter-risk-level">
                                    <option value="">All Risk Levels</option>
                                    <option value="Critical">Critical</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                            
                            <!-- Stats Bar -->
                            <div class="kb-stats-bar">
                                <div class="kb-stat-item">
                                    <span class="kb-stat-num" id="stat-total-cases">0</span>
                                    <span class="kb-stat-label">Cases</span>
                                </div>
                                <div class="kb-stat-item critical">
                                    <span class="kb-stat-num" id="stat-critical-risks">0</span>
                                    <span class="kb-stat-label">Critical</span>
                                </div>
                                <div class="kb-stat-item high">
                                    <span class="kb-stat-num" id="stat-high-risks">0</span>
                                    <span class="kb-stat-label">High</span>
                                </div>
                                <div class="kb-stat-item medium">
                                    <span class="kb-stat-num" id="stat-medium-risks">0</span>
                                    <span class="kb-stat-label">Medium</span>
                                </div>
                            </div>
                            
                            <!-- Case List -->
                            <div id="kb-case-list" class="kb-case-list">
                                <!-- Case items injected here -->
                            </div>
                        </div>
                        
                        <!-- Right: Case Detail Panel -->
                        <div class="kb-detail-panel" id="kb-detail-panel">
                            <div class="kb-detail-empty">
                                <i class="fa-solid fa-folder-open"></i>
                                <h3>Select a Case</h3>
                                <p>Choose a case from the list to view detailed risk assessment information</p>
                            </div>
                            
                            <!-- Detail Content (hidden initially) -->
                            <div class="kb-detail-content hidden" id="kb-detail-content">
                                <!-- Header -->
                                <div class="kb-detail-header">
                                    <div class="kb-detail-title-section">
                                        <span class="kb-case-id" id="detail-case-id">CASE-2024-001</span>
                                        <h2 id="detail-case-title">Case Title</h2>
                                        <div class="kb-detail-meta">
                                            <span class="kb-meta-tag type" id="detail-case-type">
                                                <i class="fa-solid fa-tag"></i> AI/ML Implementation
                                            </span>
                                            <span class="kb-meta-tag unit" id="detail-business-unit">
                                                <i class="fa-solid fa-building"></i> Customer Service
                                            </span>
                                        </div>
                                    </div>
                                    <div class="kb-detail-actions">
                                        <button class="btn icon-btn" title="Copy Case ID" onclick="copyCaseId()">
                                            <i class="fa-solid fa-copy"></i>
                                        </button>
                                        <button class="btn icon-btn" title="Export as JSON" onclick="exportCaseJson()">
                                            <i class="fa-solid fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Tabs -->
                                <div class="kb-detail-tabs">
                                    <button class="kb-tab-btn active" data-tab="overview">
                                        <i class="fa-solid fa-eye"></i> Overview
                                    </button>
                                    <button class="kb-tab-btn" data-tab="profile">
                                        <i class="fa-solid fa-briefcase"></i> Project Profile
                                    </button>
                                    <button class="kb-tab-btn" data-tab="risks">
                                        <i class="fa-solid fa-shield-halved"></i> Risk Assessment
                                    </button>
                                    <button class="kb-tab-btn" data-tab="tags">
                                        <i class="fa-solid fa-tags"></i> Tags & Related
                                    </button>
                                </div>
                                
                                <!-- Tab Content -->
                                <div class="kb-tab-content">
                                    <!-- Overview Tab -->
                                    <div class="kb-tab-pane active" id="tab-overview">
                                        <div class="kb-overview-grid">
                                            <div class="kb-overview-card summary">
                                                <h4><i class="fa-solid fa-quote-left"></i> Project Summary</h4>
                                                <p id="detail-summary">Loading...</p>
                                            </div>
                                            <div class="kb-overview-card objectives">
                                                <h4><i class="fa-solid fa-bullseye"></i> Core Objectives</h4>
                                                <ul id="detail-objectives"></ul>
                                            </div>
                                            <div class="kb-risk-matrix-card">
                                                <h4><i class="fa-solid fa-chart-pie"></i> Risk Overview</h4>
                                                <div class="kb-risk-matrix" id="detail-risk-matrix">
                                                    <!-- Risk level bars -->
                                                </div>
                                            </div>
                                            <div class="kb-keywords-card">
                                                <h4><i class="fa-solid fa-key"></i> Key Themes</h4>
                                                <div class="kb-keyword-groups">
                                                    <div class="kb-keyword-group">
                                                        <label>Business</label>
                                                        <div class="kb-keywords" id="detail-keywords-business"></div>
                                                    </div>
                                                    <div class="kb-keyword-group">
                                                        <label>Technology</label>
                                                        <div class="kb-keywords" id="detail-keywords-tech"></div>
                                                    </div>
                                                    <div class="kb-keyword-group">
                                                        <label>Regulatory</label>
                                                        <div class="kb-keywords" id="detail-keywords-regulatory"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Project Profile Tab -->
                                    <div class="kb-tab-pane" id="tab-profile">
                                        <div class="kb-profile-sections">
                                            <!-- Background & Purpose -->
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-file-lines"></i> Background & Purpose</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-info-grid" id="detail-background">
                                                        <!-- Dynamically populated -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Operational Flow -->
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-route"></i> Operational Flow</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-flow-comparison">
                                                        <div class="kb-flow-column existing">
                                                            <h5><i class="fa-solid fa-clock-rotate-left"></i> Existing Flow</h5>
                                                            <p id="detail-existing-flow-desc"></p>
                                                            <ol id="detail-existing-flow-steps" class="kb-flow-steps"></ol>
                                                        </div>
                                                        <div class="kb-flow-arrow">
                                                            <i class="fa-solid fa-arrow-right"></i>
                                                        </div>
                                                        <div class="kb-flow-column new">
                                                            <h5><i class="fa-solid fa-rocket"></i> New Flow</h5>
                                                            <p id="detail-new-flow-desc"></p>
                                                            <ol id="detail-new-flow-steps" class="kb-flow-steps"></ol>
                                                        </div>
                                                    </div>
                                                    <div class="kb-flow-impact">
                                                        <h5><i class="fa-solid fa-bolt"></i> Process Impact</h5>
                                                        <p id="detail-flow-impact"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Risk Assessment Tab -->
                                    <div class="kb-tab-pane" id="tab-risks">
                                        <div class="kb-risk-sections">
                                            <!-- Risk Summary Table -->
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-table"></i> Risk Summary</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-risk-table-wrapper">
                                                        <table class="kb-risk-table" id="detail-risk-table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Risk ID</th>
                                                                    <th>Risk Name</th>
                                                                    <th>Owner</th>
                                                                    <th>Inherent</th>
                                                                    <th>Taxonomy</th>
                                                                    <th>Conduct Risk</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <!-- Dynamically populated -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Key Drivers -->
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-magnifying-glass-chart"></i> Key Drivers for Residual Risk</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-drivers-list" id="detail-key-drivers">
                                                        <!-- Dynamically populated -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Detailed Risk Scenarios -->
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-list-check"></i> Detailed Risk Scenarios</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-scenarios-list" id="detail-risk-scenarios">
                                                        <!-- Dynamically populated -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tags & Related Tab -->
                                    <div class="kb-tab-pane" id="tab-tags">
                                        <div class="kb-tags-sections">
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-tag"></i> Classification Tags</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-tags-grid" id="detail-all-tags">
                                                        <!-- Dynamically populated -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="kb-section-card">
                                                <div class="kb-section-header">
                                                    <h4><i class="fa-solid fa-link"></i> Similar Cases</h4>
                                                </div>
                                                <div class="kb-section-content">
                                                    <div class="kb-similar-cases" id="detail-similar-cases">
                                                        <!-- Dynamically populated -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    
                    <!-- Risk Taxonomy View -->
                    <div class="kb-view-content" id="kb-view-content-taxonomy">
                        <div class="kb-taxonomy-container">
                            <!-- Left: Risk Taxonomy Selector -->
                            <div class="kb-taxonomy-selector">
                                <div class="kb-taxonomy-header">
                                    <h2><i class="fa-solid fa-diagram-project"></i> Risk Taxonomy</h2>
                                    <p class="kb-subtitle">Search cases by risk category</p>
                                </div>
                                
                                <div class="kb-taxonomy-filters">
                                    <div class="kb-taxonomy-filter-group">
                                        <label for="taxonomy-level1">
                                            <i class="fa-solid fa-layer-group"></i> Level 1 Risk Type
                                        </label>
                                        <select id="taxonomy-level1">
                                            <option value="">Select Level 1 Risk Type</option>
                                        </select>
                                        <p class="kb-filter-description" id="taxonomy-level1-desc"></p>
                                    </div>
                                    
                                    <div class="kb-taxonomy-filter-group">
                                        <label for="taxonomy-level2-3">
                                            <i class="fa-solid fa-sitemap"></i> Level 2/3 Category
                                        </label>
                                        <select id="taxonomy-level2-3">
                                            <option value="">Select Level 2/3 Category</option>
                                        </select>
                                        <p class="kb-filter-description" id="taxonomy-level2-3-desc"></p>
                                    </div>
                                    
                                    <button class="btn primary-btn" id="btn-search-taxonomy">
                                        <i class="fa-solid fa-search"></i> Search Cases
                                    </button>
                                </div>
                                
                                <div class="kb-taxonomy-stats" id="taxonomy-search-results-count">
                                    <!-- Search results count will be displayed here -->
                                </div>
                            </div>
                            
                            <!-- Right: Search Results -->
                            <div class="kb-taxonomy-results">
                                <div class="kb-taxonomy-results-header">
                                    <h3>Matching Cases</h3>
                                    <p>Cases that contain the selected risk category</p>
                                </div>
                                
                                <div id="kb-taxonomy-case-results" class="kb-taxonomy-case-results">
                                    <div class="kb-taxonomy-empty">
                                        <i class="fa-solid fa-filter"></i>
                                        <h3>Select Risk Category</h3>
                                        <p>Choose a Level 1 Risk Type and Level 2/3 Category to search for matching cases</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab Content -->
                <div id="tab-settings" class="dashboard-tab hidden">
                    <div class="settings-header">
                        <div class="settings-intro">
                            <h2><i class="fa-solid fa-gear"></i> Settings</h2>
                            <p>Configure application settings and API endpoints.</p>
                        </div>
                    </div>

                    <div class="settings-container">
                        <!-- API Configuration Section -->
                        <div class="settings-section">
                            <div class="settings-section-header">
                                <h3><i class="fa-solid fa-plug"></i> API Configuration</h3>
                                <p class="settings-section-desc">Configure external API endpoints used by the application.</p>
                            </div>
                            <div class="settings-section-content">
                                <form id="settings-form">
                                    <div class="form-group">
                                        <label for="settings-api-endpoint">
                                            Dify Workflow API Endpoint
                                            <span class="label-hint">(Optional)</span>
                                        </label>
                                        <input type="text" 
                                               id="settings-api-endpoint" 
                                               name="apiEndpoint"
                                               placeholder="https://api.dify.ai/v1/workflows/..."
                                               class="settings-input">
                                        <small class="form-hint">
                                            Enter the Dify workflow API endpoint URL. This will be used for all projects.
                                        </small>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn primary-btn">
                                            <i class="fa-solid fa-floppy-disk"></i> Save Settings
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Other Settings Sections can be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- === VIEW: PROJECT WORKSPACE === -->
        <div id="view-workspace" class="main-view hidden">

            <!-- Sidebar Navigation -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <button class="btn text-btn nav-back" id="btn-back-dashboard">
                        <i class="fa-solid fa-chevron-left"></i> Dashboard
                    </button>
                    <div class="project-title-display" id="ws-project-name">Project Name</div>
                </div>

                <ul class="ws-nav-links">
                    <li class="active" data-tab="tab-input">
                        <i class="fa-solid fa-pen-to-square"></i> Input & Docs
                    </li>
                    <li data-tab="tab-prompt">
                        <i class="fa-solid fa-robot"></i> Prompt Studio
                    </li>
                    <li data-tab="tab-generate">
                        <i class="fa-solid fa-bolt"></i> Generation
                    </li>
                    <li data-tab="tab-report">
                        <i class="fa-solid fa-file-contract"></i> Risk Report
                    </li>
                </ul>
            </nav>

            <!-- Workspace Content -->
            <main class="ws-content">

                <!-- TAB 1: INPUT & DOCS -->
                <section id="tab-input" class="tab-pane active">
                    <div class="pane-header">
                        <h2>Project Information</h2>
                        <p>Manually enter details or upload documents to auto-extract context.</p>
                    </div>

                    <div class="input-layout">
                        <!-- Left: Form -->
                        <div class="form-container">
                            <form id="project-form">
                                <div class="form-group">
                                    <label>Project Name</label>
                                    <input type="text" id="inp-projectName" required>
                                </div>
                                <div class="form-group">
                                    <label>Background & Purpose</label>
                                    <textarea id="inp-background" rows="5" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Operational Flow (Current & New)</label>
                                    <textarea id="inp-flow" rows="5" required></textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn secondary-btn">Save Changes</button>
                                </div>
                            </form>
                        </div>

                        <!-- Right: Document Upload -->
                        <div class="upload-container">
                            <div class="drop-zone" id="doc-drop-zone">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <h3>Upload Project Docs</h3>
                                <p>Drag & drop PDF/Word/MD files here</p>
                                <button class="btn sm-btn">Browse Files</button>
                            </div>
                            <div id="uploaded-files-list" class="file-list">
                                <!-- File items -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- TAB 2: PROMPT STUDIO -->
                <section id="tab-prompt" class="tab-pane">
                    <div class="pane-header">
                        <h2>Prompt Studio</h2>
                        <p>Customize the LLM System Prompt. These modules are combined with the Context (Module 2) and
                            Output Format (Module 5) at runtime.</p>
                    </div>

                    <div class="prompt-editor-layout">
                        <div class="prompt-sidebar">
                            <button class="prompt-nav-btn active" data-module="1">
                                <span>1</span> Role & Context
                            </button>
                            <button class="prompt-nav-btn" data-module="3">
                                <span>3</span> Guidelines & Standards
                            </button>
                            <button class="prompt-nav-btn" data-module="4">
                                <span>4</span> Instructions
                            </button>
                        </div>

                        <div class="editor-area">
                            <div class="editor-toolbar">
                                <span id="current-module-label">Module 1: Role & Context</span>
                                <button class="btn sm-btn" id="btn-reset-prompt">Reset to Default</button>
                            </div>
                            <textarea id="prompt-editor-textarea" class="code-editor" spellcheck="false"></textarea>
                            <div class="editor-footer">
                                <button class="btn primary-btn" id="btn-save-prompt">Save Module</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- TAB 3: GENERATION - REDESIGNED -->
                <section id="tab-generate" class="tab-pane generation-page">
                    <div class="generation-layout">
                        <!-- Left Panel: Risk Papers List -->
                        <aside class="papers-sidebar">
                            <div class="papers-header">
                                <h3><i class="fa-solid fa-file-lines"></i> Risk Papers</h3>
                            </div>
                            <div id="papers-list" class="papers-list">
                                <!-- Dynamically populated -->
                                <div class="empty-papers">
                                    <i class="fa-regular fa-folder-open"></i>
                                    <p>No papers yet</p>
                                </div>
                            </div>
                        </aside>

                        <!-- Right Panel: Generation Workflow -->
                        <div class="generation-main">
                            <!-- Create New Paper Header -->
                            <div class="generation-header">
                                <div class="paper-input-group">
                                    <label for="paper-name-input">
                                        <i class="fa-solid fa-file-signature"></i> Create New Risk Paper
                                    </label>
                                    <div class="input-with-button">
                                        <input type="text" id="paper-name-input"
                                            placeholder="e.g., GenAI Chatbot Assessment v1.0">
                                        <button id="btn-start-generation" class="btn primary-btn">
                                            <i class="fa-solid fa-bolt"></i> Generate
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Workflow Steps -->
                            <div class="workflow-container">
                                <!-- Step 1: Assembling Prompts -->
                                <div class="workflow-step" id="step-prompts" data-status="pending">
                                    <div class="step-header">
                                        <div class="step-indicator">
                                            <span class="step-number">1</span>
                                            <i class="fa-solid fa-check step-check"></i>
                                            <i class="fa-solid fa-spinner fa-spin step-spinner"></i>
                                        </div>
                                        <div class="step-info">
                                            <h4>Assembling Prompts</h4>
                                            <p class="step-desc">Fetching prompt modules from Prompt Studio</p>
                                        </div>
                                        <div class="step-status">
                                            <span class="status-badge pending">Pending</span>
                                        </div>
                                        <button class="step-toggle" onclick="toggleStepData('prompts')">
                                            <i class="fa-solid fa-chevron-down"></i>
                                        </button>
                                    </div>
                                    <div class="step-data" id="step-data-prompts">
                                        <div class="data-preview">
                                            <div class="data-item">
                                                <span class="data-label">Module 1: Role & Context</span>
                                                <pre class="data-value" id="captured-module1">--</pre>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Module 3: Guidelines</span>
                                                <pre class="data-value" id="captured-module3">--</pre>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Module 4: Instructions</span>
                                                <pre class="data-value" id="captured-module4">--</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 2: Fetching User Inputs -->
                                <div class="workflow-step" id="step-inputs" data-status="pending">
                                    <div class="step-header">
                                        <div class="step-indicator">
                                            <span class="step-number">2</span>
                                            <i class="fa-solid fa-check step-check"></i>
                                            <i class="fa-solid fa-spinner fa-spin step-spinner"></i>
                                        </div>
                                        <div class="step-info">
                                            <h4>Fetching User Inputs</h4>
                                            <p class="step-desc">Collecting project information from Input Data tab</p>
                                        </div>
                                        <div class="step-status">
                                            <span class="status-badge pending">Pending</span>
                                        </div>
                                        <button class="step-toggle" onclick="toggleStepData('inputs')">
                                            <i class="fa-solid fa-chevron-down"></i>
                                        </button>
                                    </div>
                                    <div class="step-data" id="step-data-inputs">
                                        <div class="data-preview">
                                            <div class="data-item">
                                                <span class="data-label">Project Background</span>
                                                <pre class="data-value" id="captured-background">--</pre>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Operational Flow</span>
                                                <pre class="data-value" id="captured-flow">--</pre>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">API Endpoint</span>
                                                <pre class="data-value" id="captured-api">--</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 3: Retrieving Historical Cases (NEW) -->
                                <div class="workflow-step" id="step-retrieval" data-status="pending">
                                    <div class="step-header">
                                        <div class="step-indicator">
                                            <span class="step-number">3</span>
                                            <i class="fa-solid fa-check step-check"></i>
                                            <i class="fa-solid fa-spinner fa-spin step-spinner"></i>
                                        </div>
                                        <div class="step-info">
                                            <h4>Retrieving Historical Cases</h4>
                                            <p class="step-desc">Finding relevant past assessments for few-shot learning
                                            </p>
                                        </div>
                                        <div class="step-status">
                                            <span class="status-badge pending">Pending</span>
                                        </div>
                                        <button class="step-toggle" onclick="toggleStepData('retrieval')">
                                            <i class="fa-solid fa-chevron-down"></i>
                                        </button>
                                    </div>
                                    <div class="step-data" id="step-data-retrieval">
                                        <div class="data-preview">
                                            <div class="data-item">
                                                <span class="data-label">Retrieved Examples</span>
                                                <div id="captured-cases" class="captured-cases-list">
                                                    <!-- Dynamically populated -->
                                                    <em style="color:var(--text-secondary);font-size:0.8rem;">Waiting
                                                        for retrieval...</em>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 4: Generating Risk Analysis -->
                                <div class="workflow-step" id="step-analysis" data-status="pending">
                                    <div class="step-header">
                                        <div class="step-indicator">
                                            <span class="step-number">4</span>
                                            <i class="fa-solid fa-check step-check"></i>
                                            <i class="fa-solid fa-spinner fa-spin step-spinner"></i>
                                        </div>
                                        <div class="step-info">
                                            <h4>Generating Risk Analysis</h4>
                                            <p class="step-desc">Analyzing each risk category with LLM</p>
                                        </div>
                                        <div class="step-status">
                                            <span class="status-badge pending">Pending</span>
                                        </div>
                                        <button class="step-toggle" onclick="toggleStepData('analysis')">
                                            <i class="fa-solid fa-chevron-down"></i>
                                        </button>
                                    </div>
                                    <div class="step-data" id="step-data-analysis">
                                        <div class="analysis-progress">
                                            <div class="progress-info">
                                                <span id="analysis-current-cat">Waiting to start...</span>
                                                <span id="analysis-progress-text">0 / 0</span>
                                            </div>
                                            <div class="progress-bar-track">
                                                <div class="progress-bar-fill" id="analysis-progress-bar"></div>
                                            </div>
                                            <div class="analysis-log" id="analysis-log">
                                                <!-- Log entries -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Completion Message -->
                            <div id="generation-complete" class="generation-complete hidden">
                                <i class="fa-solid fa-circle-check"></i>
                                <h3>Risk Paper Generated Successfully!</h3>
                                <p>Click the paper in the left panel to view the full report.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- TAB 4: RISK REPORT - REDESIGNED -->
                <section id="tab-report" class="tab-pane report-page">
                    <!-- Report Layout with Papers Sidebar + Navigation + Main -->
                    <div class="report-layout">
                        <!-- Far Left: Papers List Sidebar -->
                        <aside class="report-papers-sidebar">
                            <div class="papers-header">
                                <h4><i class="fa-solid fa-file-lines"></i> Risk Papers</h4>
                            </div>
                            <div id="report-papers-list" class="papers-list">
                                <!-- Dynamically populated -->
                                <div class="empty-papers">
                                    <i class="fa-regular fa-folder-open"></i>
                                    <p>No papers yet</p>
                                </div>
                            </div>
                        </aside>

                        <!-- Left: Quick Navigation Sidebar -->
                        <aside class="report-nav-sidebar">
                            <div class="nav-sidebar-header">
                                <h4><i class="fa-solid fa-compass"></i> Quick Navigation</h4>
                                <div class="nav-search-box">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                    <input type="text" id="nav-search-input" placeholder="Filter risks..." 
                                           onkeyup="filterNavigation(this.value)">
                                </div>
                            </div>
                            <div id="report-nav-list" class="nav-list">
                                <!-- Dynamically populated -->
                            </div>
                            <div class="nav-sidebar-footer">
                                <div class="progress-summary">
                                    <div class="progress-ring">
                                        <span id="nav-progress-pct">0%</span>
                                    </div>
                                    <div class="progress-text">
                                        <span id="nav-progress-label">Completed</span>
                                    </div>
                                </div>
                            </div>
                        </aside>

                        <!-- Right: Main Content Area -->
                        <div class="report-main">
                            <!-- Enhanced Toolbar -->
                            <div class="report-toolbar-v2">
                                <div class="toolbar-left">
                                    <div class="search-inline">
                                        <i class="fa-solid fa-search"></i>
                                        <input type="text" id="risk-search" placeholder="Search risks...">
                                    </div>
                                </div>
                                <div class="toolbar-center">
                                    <div class="filter-pills">
                                        <select id="filter-category" class="filter-select">
                                            <option value="">All Categories</option>
                                        </select>
                                        <select id="filter-rating" class="filter-select">
                                            <option value="">All Ratings</option>
                                            <option value="Critical">Critical</option>
                                            <option value="High">High</option>
                                            <option value="Medium">Medium</option>
                                            <option value="Low">Low</option>
                                        </select>
                                        <select id="filter-status" class="filter-select">
                                            <option value="">All Status</option>
                                            <option value="draft">Draft</option>
                                            <option value="review">In Review</option>
                                            <option value="final">Finalized</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <button class="btn icon-text-btn" id="btn-collapse-all" title="Collapse All">
                                        <i class="fa-solid fa-compress-alt"></i>
                                    </button>
                                    <button class="btn icon-text-btn" id="btn-expand-all" title="Expand All">
                                        <i class="fa-solid fa-expand-alt"></i>
                                    </button>
                                    <div class="toolbar-divider"></div>
                                    <button class="btn secondary-btn" id="btn-download-report">
                                        <i class="fa-solid fa-download"></i> Download
                                    </button>
                                    <button class="btn primary-btn" id="btn-email-report">
                                        <i class="fa-solid fa-envelope"></i> Send to Email
                                    </button>
                                </div>
                            </div>

                            <!-- Stats Bar -->
                            <div class="report-stats-bar">
                                <div class="stat-pill">
                                    <span class="stat-value" id="stat-total-risks">0</span>
                                    <span class="stat-name">Total</span>
                                </div>
                                <div class="stat-pill critical">
                                    <span class="stat-value" id="stat-critical">0</span>
                                    <span class="stat-name">Critical</span>
                                </div>
                                <div class="stat-pill high">
                                    <span class="stat-value" id="stat-high">0</span>
                                    <span class="stat-name">High</span>
                                </div>
                                <div class="stat-pill medium">
                                    <span class="stat-value" id="stat-medium">0</span>
                                    <span class="stat-name">Medium</span>
                                </div>
                                <div class="stat-pill low">
                                    <span class="stat-value" id="stat-low">0</span>
                                    <span class="stat-name">Low</span>
                                </div>
                                <div class="stat-pill na">
                                    <span class="stat-value" id="stat-na">0</span>
                                    <span class="stat-name">N/A</span>
                                </div>
                            </div>

                            <!-- Risk Cards Container -->
                            <div id="risk-report-container" class="risk-report-container">
                                <!-- Risk cards grouped by category rendered here -->
                                <div class="empty-state">
                                    <i class="fa-regular fa-clipboard"></i>
                                    <p>No assessment generated yet. Run the analysis to populate this report.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Action Button -->
                    <button class="fab-add" id="btn-add-risk" title="Add New Risk">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </section>

            </main>
        </div>

        <!-- Modals -->
        <div id="modal-new-project" class="modal-overlay hidden">
            <div class="modal-card">
                <h3>New Project</h3>
                <input type="text" id="new-project-name" placeholder="Enter Project Name">
                <div class="modal-actions">
                    <button class="btn text-btn" id="btn-cancel-new">Cancel</button>
                    <button class="btn primary-btn" id="btn-confirm-new">Create</button>
                </div>
            </div>
        </div>

        <!-- Case Detail Modal -->
        <div id="modal-case-detail" class="modal-overlay hidden">
            <div class="modal-card modal-lg">
                <div class="modal-header">
                    <h3 id="case-detail-title">Case Details</h3>
                    <button class="modal-close" onclick="closeCaseModal()">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div id="case-detail-content" class="case-detail-body">
                    <!-- Dynamic content injected here -->
                </div>
            </div>
        </div>

        <!-- Upload Case Modal -->
        <div id="modal-upload-case" class="modal-overlay hidden">
            <div class="modal-card">
                <h3><i class="fa-solid fa-cloud-arrow-up"></i> Upload Case Paper</h3>
                <p class="modal-desc">Upload a completed operational risk assessment document. The system will parse and
                    extract metadata for retrieval.</p>
                <div class="upload-area" id="case-drop-zone">
                    <i class="fa-solid fa-file-pdf"></i>
                    <span>Drag & drop PDF file here or click to browse</span>
                </div>
                <div class="modal-actions">
                    <button class="btn text-btn" onclick="closeUploadModal()">Cancel</button>
                    <button class="btn primary-btn" id="btn-process-upload" disabled>Process Document</button>
                </div>
            </div>
        </div>

        <!-- SME Comment Modal -->
        <div id="modal-sme-comment" class="modal-overlay hidden">
            <div class="modal-card modal-lg">
                <div class="modal-header">
                    <h3><i class="fa-solid fa-comment-dots"></i> Add SME Review Comment</h3>
                    <button class="modal-close" onclick="closeSMECommentModal()">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="sme-comment-form">
                        <div class="form-group">
                            <label for="sme-comment-role">SME Role <span class="required">*</span></label>
                            <select id="sme-comment-role" required>
                                <option value="">Select SME Role</option>
                                <option value="Risk Owner">Risk Owner</option>
                                <option value="Legal">Legal</option>
                                <option value="Compliance">Compliance</option>
                                <option value="Op Risk Management">Op Risk Management</option>
                                <option value="LIS">LIS</option>
                                <option value="Tech Risk">Tech Risk</option>
                                <option value="AI Governance">AI Governance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sme-comment-ir-rating">Inherent Risk (IR) Rating</label>
                            <select id="sme-comment-ir-rating">
                                <option value="">Select Rating</option>
                                <option value="Critical">Critical</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sme-comment-rr-rating">Residual Risk (RR) Rating</label>
                            <select id="sme-comment-rr-rating">
                                <option value="">Select Rating</option>
                                <option value="Critical">Critical</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sme-comment-justification">Justification / Comments</label>
                            <textarea id="sme-comment-justification" rows="5" 
                                placeholder="Provide rationale for your risk rating assessment..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-actions">
                    <button class="btn text-btn" onclick="closeSMECommentModal()">Cancel</button>
                    <button class="btn primary-btn" id="btn-submit-sme-comment">Submit Comment</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Data Files (loaded as regular scripts for global access) -->
    <script src="js/risk_taxonomy_data.js"></script>
    <script src="js/knowledge_data.js"></script>
    <script src="js/demo_data.js"></script>
    <!--   js/demo_data.js  -->
    
    <!-- Main Application (ES6 Modules) -->
    <script type="module" src="js/main.js"></script>
</body>

</html>